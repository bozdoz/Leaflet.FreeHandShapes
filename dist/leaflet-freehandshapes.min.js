!function t(e,i,n){function o(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(s)return s(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[r]={exports:{}};e[r][0].call(u.exports,function(t){var i=e[r][1][t];return o(i?i:t)},u,u.exports,t,e,i,n)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(t,e,i){function n(){}n.prototype={map:null,setMap:function(t){this.map=t},brian3kbGrahamScan:function(t){var e=new ConvexHullGrahamScan,i=[],n=[],o=[];t.forEach(function(t){n.push(this.map.latLngToLayerPoint(t))}.bind(this)),n.forEach(function(t){e.addPoint(t.x,t.y)}.bind(this));var s=e.getHull();return s.forEach(function(t){i.push(L.point(t.x,t.y))}.bind(this)),i.push(i[0]),i.forEach(function(t){o.push(this.map.layerPointToLatLng(t))}.bind(this)),o},wildhoneyConcaveHull:function(t){return t.push(t[0]),new ConcaveHull(t).getLatLngs()}},"object"==typeof e&&"object"==typeof e.exports&&(e.exports=n)},{}],2:[function(t,e,i){function n(){}n.prototype={states:[[]],current:0,save:function(t){this.current++,this.states[this.current]&&this.clearFrom(this.current),this.states[this.current]||(this.states[this.current]=[]),t.forEach(function(t){this.states[this.current].push(t._latlngs)}.bind(this))},undo:function(){return this.current--,this.states[this.current]||this.current++,this.states[this.current]},canUndo:function(){return!!this.states[this.current-1]},redo:function(){return this.current++,this.states[this.current]||this.current--,this.states[this.current]},canRedo:function(){return!!this.states[this.current+1]},clearFrom:function(t){this.states.splice(t)}},"object"==typeof e&&"object"==typeof e.exports&&(e.exports=n)},{}],3:[function(t,e,i){var n={multiplePolygons:!0,events:[],simplifyPolygon:!0,invalidLength:3,hullAlgorithm:"wildhoneyConcaveHull",boundariesAfterEdit:!1,createExitMode:!0,attemptMerge:!0,smoothFactor:5,iconClassName:"polygon-elbow",svgClassName:"tracer",polygonClassName:"tracer",deleteExitMode:!1,memoriseEachEdge:!0,destroyPrevious:!1,disablePropagation:!1,elbowDistance:10,onlyInDistance:!1,hullAlgorithms:{"brian3kb/graham_scan_js":{method:"brian3kbGrahamScan",name:"Graham Scan JS",global:"ConvexHullGrahamScan",link:"https://github.com/brian3kb/graham_scan_js"},"Wildhoney/ConcaveHull":{method:"wildhoneyConcaveHull",name:"Concave Hull",global:"ConcaveHull",link:"https://github.com/Wildhoney/ConcaveHull"}},setEvents:function(t){this.events=t},setMemoriseEachEdge:function(t){this.memoriseEachEdge=!!t},addElbowOnlyWithinDistance:function(t){this.onlyInDistance=!!t},setPathClipperPadding:function(t){L.Path.CLIP_PADDING=t},disableStopPropagation:function(){this.disablePropagation=!0},setMaximumDistanceForElbow:function(t){this.elbowDistance=+t},exitModeAfterCreate:function(t){this.createExitMode=!!t},exitModeAfterDelete:function(t){this.deleteExitMode=!!t},destroyPreviousPolygon:function(t){this.destroyPrevious=!!t},allowMultiplePolygons:function(t){this.multiplePolygons=!!t},setSVGClassName:function(t){this.svgClassName=t},setBoundariesAfterEdit:function(t){this.boundariesAfterEdit=!!t},setSmoothFactor:function(t){this.smoothFactor=+t},setIconClassName:function(t){this.iconClassName=t},setPolygonClassName:function(t){this.polygonClassName=t},setHullAlgorithm:function(t){if(!t||this.hullAlgorithms.hasOwnProperty(t)){if(!t)return void(this.hullAlgorithm=!1);t=this.hullAlgorithms[t],"undefined"==typeof $window[t.global]&&L.FreeDraw.Throw(t.name+" is a required library for concave/convex hulls",t.link),this.hullAlgorithm=t.method}}};"object"==typeof e&&"object"==typeof e.exports&&(e.exports=n)},{}],4:[function(t,e,i){var n=t("./Memory"),o=t("./Hull");L.FreeHandShapes=L.FeatureGroup.extend({statics:{RECOUNT_TIMEOUT:1},options:t("./Options"),initialize:function(t){return"undefined"==typeof d3?void console.error("D3 is a required library","http://d3js.org/"):"undefined"==typeof ClipperLib?void console.error("JSClipper is a required library","http://sourceforge.net/p/jsclipper/wiki/Home%206/"):(L.Util.setOptions(this,t),this.fromPoint={x:0,y:0},this.polygons=[],this.edges=[],this._latLngs=[],this.memory=new n,this.hull=new o,this.element=t.element||null,this.setMode(t.mode||1),void(this.Polygon=L.Polygon.extend({options:{className:"leaflet-free-hand-shapes"}})))},recreateEdges:function(t){return this.edges=this.edges.filter(function(e){return e._freedraw.polygon!==t||void this.map.removeLayer(e)}.bind(this)),this.createEdges(t)},resurrectOrphans:function(){var t=function(t){setTimeout(function(){this.silently(function(){this.recreateEdges(t)}.bind(this))}.bind(this))},e=this.getPolygons(!0);e.forEach(function(e){e&&e._parts[0]&&t.call(this,e)}.bind(this)),setTimeout(function(){this.notifyBoundaries()}.bind(this))},onAdd:function(t){t.on("zoomend",function(){setTimeout(this.resurrectOrphans.bind(this))}.bind(this)),this.map=t,this.mode=this.mode||L.FreeHandShapes.MODES.VIEW,this.defaultPreferences={dragging:t.dragging._enabled,touchZoom:t.touchZoom._enabled,doubleClickZoom:t.doubleClickZoom._enabled,scrollWheelZoom:t.scrollWheelZoom._enabled},this.element||(this.element=t._container),this.lineFunction=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear"),this.createD3(),this.map.on(this.options.events[0]||"mousedown touchstart",this.bindEvents().mouseDown),this.map.on(this.options.events[1]||"mousemove touchmove",this.bindEvents().mouseMove),this.map.on(this.options.events[2]||"mouseup   touchend",this.bindEvents().mouseUpLeave);var e=window.document.getElementsByTagName("body")[0];e.addEventListener("mouseleave",this.bindEvents().mouseUpLeave),this.setMode(this.mode)},onRemove:function(){this._clearPolygons(),this.map.off(this.options.events[0]||"mousedown touchstart",this.bindEvents().mouseDown),this.map.off(this.options.events[1]||"mousemove touchmove",this.bindEvents().mouseMove),this.map.off(this.options.events[2]||"mousedown touchstart",this.bindEvents().mouseUpLeave);var t=window.document.getElementsByTagName("body")[0];t.removeEventListener("mouseleave",this.bindEvents().mouseUpLeave)},silently:function(t){var e=this.silenced;this.silenced=!0,t.apply(this),e||(this.silenced=!1)},cancelAction:function(){this.creating=!1,this.movingEdge=null,this.destroyD3().createD3()},setMapPermissions:function(t){this.map.dragging[t](),this.map.touchZoom[t](),this.map.doubleClickZoom[t](),this.map.scrollWheelZoom[t](),"enable"===t&&(this.defaultPreferences.dragging||this.map.dragging.disable(),this.defaultPreferences.touchZoom||this.map.touchZoom.disable(),this.defaultPreferences.doubleClickZoom||this.map.doubleClickZoom.disable(),this.defaultPreferences.scrollWheelZoom||this.map.scrollWheelZoom.disable())},setMode:function(t){if(t=0===t?L.FreeHandShapes.MODES.VIEW:t,this.mode=t,this.fire("mode",{mode:t}),this.map){var e=!!(t&L.FreeHandShapes.MODES.CREATE),i=e?"disable":"enable";this.map.dragging[i](),!this.boundaryUpdateRequired||this.mode&L.FreeHandShapes.MODES.EDIT||(this.notifyBoundaries(),this.boundaryUpdateRequired=!1,this.options.memoriseEachEdge||this.memory.save(this.getPolygons(!0))),function(e,i,n,o){o(i,"mode-create"),o(i,"mode-edit"),o(i,"mode-delete"),o(i,"mode-view"),o(i,"mode-append"),t&e.CREATE&&n(i,"mode-create"),t&e.EDIT&&n(i,"mode-edit"),t&e.DELETE&&n(i,"mode-delete"),t&e.VIEW&&n(i,"mode-view"),t&e.APPEND&&n(i,"mode-append")}(L.FreeHandShapes.MODES,this.map._container,L.DomUtil.addClass,L.DomUtil.removeClass)}},unsetMode:function(t){this.setMode(this.mode^t)},createD3:function(){this.svg=d3.select(this.options.element||this.element).append("svg").attr("class",this.options.svgClassName).attr("width",200).attr("height",200)},destroyD3:function(){return this.svg.remove(),this.svg={},this},latLngsToClipperPoints:function(t){return t.map(function(t){var e=this.map.latLngToLayerPoint(t);return{X:e.x,Y:e.y}}.bind(this))},clipperPolygonsToLatLngs:function(t){var e=[];return t.forEach(function(t){t.forEach(function(t){t=L.point(t.X,t.Y);var i=this.map.layerPointToLatLng(t);e.push(i)}.bind(this))}.bind(this)),e},uniqueLatLngs:function(t){var e=[],i=[];return t.forEach(function(t){var n=JSON.stringify(t);e.indexOf(n)===-1&&(e.push(n),i.push(t))}),i},handlePolygonClick:function(t,e){var i=[],n=this.map.mouseEventToContainerPoint(e.originalEvent),o=1/0,s=new L.Point,r=new L.Point,a=[];t._latlngs.forEach(function(t){a.push(this.map.latLngToContainerPoint(t))}.bind(this)),a.forEach(function(t,e){var i=t,h=a[e+1]||a[0],l=L.LineUtil.pointToSegmentDistance(n,i,h);l<o&&(o=l,s=i,r=h)}.bind(this)),a.forEach(function(t,e){var o=a[e+1]||a[0];return t===s&&o===r?(i.push(this.map.containerPointToLatLng(t)),void i.push(this.map.containerPointToLatLng(n))):void i.push(this.map.containerPointToLatLng(t))}.bind(this));var h=this.options.elbowDistance,l=function(){this.mode&L.FreeHandShapes.MODES.APPEND&&(t.setLatLngs(i),this.destroyEdges(t),this.createEdges(t))}.bind(this);if(this.mode&L.FreeHandShapes.MODES.APPEND&&!(this.mode&L.FreeHandShapes.MODES.DELETE)){if(this.options.onlyInDistance&&o>h)return;return void l()}return this.mode&L.FreeHandShapes.MODES.DELETE&&!(this.mode&L.FreeHandShapes.MODES.APPEND)?void this.destroyPolygon(t):o>h&&this.mode&L.FreeHandShapes.MODES.DELETE?void this.destroyPolygon(t):void l()},createPolygon:function(t,e){if(!this.options.multiplePolygons&&this.getPolygons(!0).length>=1){if(!this.options.destroyPrevious)return this.destroyD3().createD3(),!1;this.silently(this.clearPolygons)}if(this.destroyD3().createD3(),this.options.simplifyPolygon&&(t=function(){var e=ClipperLib.Clipper.CleanPolygon(this.latLngsToClipperPoints(t),1.1),i=ClipperLib.Clipper.SimplifyPolygon(e,ClipperLib.PolyFillType.pftNonZero);return this.clipperPolygonsToLatLngs(i)}.apply(this)),t.length<=this.options.invalidLength&&!e)return!1;var i=this.options.polygonClassName,n=L.extend({},{smoothFactor:this.options.smoothFactor,className:Array.isArray(i)?i[this.polygons.length]:i},this.options.polygon),o=new this.Polygon(t,n);return o.on("click",function(t){this.handlePolygonClick(o,t)}.bind(this)),o.addTo(this.map),this.polygons.push(o),this.createEdges(o),function(){!this.silenced&&o._parts[0]&&(o._latlngs=[],o._parts[0].forEach(function(t){o._latlngs.push(this.map.layerPointToLatLng(t))}.bind(this)))}.bind(this)(),this.options.attemptMerge&&!this.silenced&&this.mergePolygons(),this.silenced||(this.notifyBoundaries(),this.memory.save(this.getPolygons(!0))),o},predefinedPolygon:function(t){return this.createPolygon(t,!0)},undo:function(){this._modifyState("undo")},redo:function(){this._modifyState("redo")},_modifyState:function(t){this.silently(this._clearPolygons.bind(this));var e=this.memory[t]();e.forEach(function(t){this.silently(function(){this.createPolygon(t)}.bind(this))}.bind(this)),this.notifyBoundaries()},getPolygons:function(t){var e=[];if(t){if(!this.map)return[];var i="G";for(var n in this.map._layers)if(this.map._layers.hasOwnProperty(n)){var o=this.map._layers[n];o._container&&o._container.tagName.toUpperCase()===i&&o instanceof this.Polygon&&e.push(o)}}else this.edges.forEach(function(t){e.indexOf(t._freedraw.polygon)===-1&&t._freedraw.polygon instanceof this.Polygon&&e.push(t._freedraw.polygon)}.bind(this));return e},mergePolygons:function(){var t=function(){var t=this.getPolygons(),e=[];t.forEach(function(t){e.push(this.latLngsToClipperPoints(t._latlngs))}.bind(this));var i=ClipperLib.Clipper.SimplifyPolygons(e,ClipperLib.PolyFillType.pftNonZero);this.silently(function(){this._clearPolygons(),i.forEach(function(t){var e=[];t.forEach(function(t){t=L.point(t.X,t.Y),e.push(this.map.layerPointToLatLng(t))}.bind(this)),this.createPolygon(e,!0)}.bind(this))})}.bind(this);t(),t(),this.getPolygons(!0).forEach(this.trimPolygonEdges.bind(this))},destroyPolygon:function(t){this.map.removeLayer(t);var e=this.polygons.indexOf(t);this.polygons.splice(e,1),this.destroyEdges(t),this.silenced||(this.notifyBoundaries(),this.memory.save(this.getPolygons(!0))),this.options.deleteExitMode&&!this.silenced&&this.setMode(this.mode^L.FreeHandShapes.MODES.DELETE)},destroyEdges:function(t){this.edges=this.edges.filter(function(e){return e._freedraw.polygon!==t||void this.map.removeLayer(e)}.bind(this))},clearPolygons:function(){this.silently(this._clearPolygons),this.silenced||(this.notifyBoundaries(),this.memory.save(this.getPolygons(!0)))},_clearPolygons:function(){this.getPolygons().forEach(function(t){this.destroyPolygon(t)}.bind(this)),this.silenced||this.notifyBoundaries()},notifyBoundaries:function(){var t=[];this.getPolygons(!0).forEach(function(e){t.push(e._latlngs)}.bind(this)),function(){t.forEach(function(t){var e=t.length-1;if(e&&t[0]&&t[e]){var i=t[0].lat!==t[e].lat,n=t[0].lng!==t[e].lng;(i||n)&&t.push(t[0])}})}.bind(this)(),this.polygonCount=t.length;var e=JSON.stringify(t);this.lastNotification!==e&&(this.lastNotification=e,this.fire("markers",{latLngs:t}),setTimeout(this.emitPolygonCount.bind(this),L.FreeHandShapes.RECOUNT_TIMEOUT))},emitPolygonCount:function(){var t="M0 0",e=this.getPolygons(!0),i=e.every(function(e){var i=e._container.lastChild.getAttribute("d").trim();return i===t});i&&(this.silently(function(){this._clearPolygons(),this.fire("markers",{latLngs:[]}),this.fire("count",{count:this.polygonCount})}.bind(this)),this.polygonCount=0,e.length=0),e.length!==this.polygonCount&&(this.polygonCount=e.length,this.fire("count",{count:this.polygonCount}))},createEdges:function(t){var e=function(t){return t._parts[0]?t._latlngs.map(function(t){return this.map.latLngToLayerPoint(t)}.bind(this)):[]}.bind(this),i=this.uniqueLatLngs(e(t)),n=this.polygons.indexOf(t),o=0;return!!i&&(i.forEach(function(e){var i=new L.DivIcon({className:Array.isArray(this.options.iconClassName)?this.options.iconClassName[n]:this.options.iconClassName}),s=this.map.layerPointToLatLng(e);i=L.marker(s,{icon:i}).addTo(this.map),i._freedraw={polygon:t,polygonId:t._leaflet_id,latLng:i._latlng},this.edges.push(i),o++,i.on("mousedown touchstart",function(t){t.originalEvent.preventDefault(),t.originalEvent.stopPropagation(),this.movingEdge=t.target}.bind(this))}.bind(this)),o)},updatePolygonEdge:function(t,e,i){var n=this.map.containerPointToLatLng(new L.Point(e,i));t.setLatLng(n),t._freedraw.latLng=n;var o=[],s=this.edges.filter(function(e){return o.push(e),e._freedraw.polygon===t._freedraw.polygon});this.edges=o;var r=[];s.forEach(function(t){r.push(t.getLatLng())}),t._freedraw.polygon.setLatLngs(r),t._freedraw.polygon.redraw()},bindEvents:function(){return this.events?this.events:(this.events={mouseDown:function(t){if(!this.creating){var e=2;if(t.originalEvent.button!==e){var i=t.originalEvent;this.options.disablePropagation||i.stopPropagation(),i.preventDefault(),this.latLngs=[],this.fromPoint=this.map.latLngToContainerPoint(t.latlng),this.mode&L.FreeHandShapes.MODES.CREATE&&(this.creating=!0,this.setMapPermissions("disable"))}}}.bind(this),mouseMove:function(t){var e=t.originalEvent;return this.movingEdge?void this._editMouseMove(t):void(this.creating&&this._createMouseMove(e))}.bind(this),mouseUpLeave:function(){return this.movingEdge?(this.options.boundariesAfterEdit?this.boundaryUpdateRequired=!0:this.notifyBoundaries(),this.trimPolygonEdges(this.movingEdge._freedraw.polygon),this.mergePolygons(),this.movingEdge=null,this.options.memoriseEachEdge&&this.memory.save(this.getPolygons(!0)),void setTimeout(this.emitPolygonCount.bind(this),L.FreeHandShapes.RECOUNT_TIMEOUT)):void this._createMouseUp()}.bind(this)},this.events)},_editMouseMove:function(t){var e=this.map.latLngToContainerPoint(t.latlng),i=this.movingEdge._icon.style;i[L.DomUtil.TRANSFORM]=e,this.updatePolygonEdge(this.movingEdge,e.x,e.y)},trimPolygonEdges:function(t){var e=[];t&&0!==t._parts.length&&t._parts[0]&&(t._parts[0].forEach(function(t){e.push(this.map.layerPointToLatLng(t))}.bind(this)),t.setLatLngs(e),t.redraw(),this.destroyEdges(t),this.createEdges(t))},_createMouseMove:function(t){var e=this.map.mouseEventToContainerPoint(t),i=this.map.containerPointToLatLng(e),n=[this.fromPoint,new L.Point(e.x,e.y)];this.svg.append("path").classed("drawing-line",!0).attr("d",this.lineFunction(n)).attr("stroke","#D7217E").attr("stroke-width",2).attr("fill","none"),this.fromPoint.x=e.x,this.fromPoint.y=e.y,this.latLngs.push(i)},_createMouseUp:function(){if(this.creating&&(this.creating=!1,!(this.latLngs.length<=2))){if(this.options.hullAlgorithm){this.hull.setMap(this.map);var t=this.hull[this.options.hullAlgorithm](this.latLngs)}this.latLngs.push(this.latLngs[0]);var e=this.createPolygon(t||this.latLngs);if(!e)return void this.setMapPermissions("enable");this.latLngs=[],this.options.createExitMode&&this.setMode(this.mode^L.FreeHandShapes.MODES.CREATE),this.setMapPermissions("enable")}}}),L.FreeHandShapes.MODES={NONE:0,VIEW:1,CREATE:2,EDIT:4,DELETE:8,APPEND:16,EDIT_APPEND:20,ALL:31}},{"./Hull":1,"./Memory":2,"./Options":3}]},{},[4]);